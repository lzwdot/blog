<template><h1 id="laravel-mix配置vue的懒加载" tabindex="-1"><a class="header-anchor" href="#laravel-mix配置vue的懒加载" aria-hidden="true">#</a> laravel-mix配置vue的懒加载</h1>
<blockquote>
<p>注：laravel 5.8版本</p>
</blockquote>
<h2 id="路由懒加载" tabindex="-1"><a class="header-anchor" href="#路由懒加载" aria-hidden="true">#</a> 路由懒加载</h2>
<p>修改之前的路由为懒加载模式，其他不需要变动：</p>
<div class="language-javascript ext-js"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> Example <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./components/Example.vue'</span><span class="token punctuation">)</span>
<span class="token comment">//改为</span>
<span class="token keyword">const</span> <span class="token function-variable function">Example</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/Example.vue'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="webpack-mix-js" tabindex="-1"><a class="header-anchor" href="#webpack-mix-js" aria-hidden="true">#</a> webpack.mix.js</h2>
<p>更新 webpack 配置，使其支持把组件按组分块打包：</p>
<div class="language-javascript ext-js"><pre v-pre class="language-javascript"><code>mix<span class="token punctuation">.</span><span class="token function">js</span><span class="token punctuation">(</span><span class="token string">'resources/js/app.js'</span><span class="token punctuation">,</span> <span class="token string">'public/js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token string">'resources/sass/app.scss'</span><span class="token punctuation">,</span> <span class="token string">'public/css'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'vue-router'</span><span class="token punctuation">,</span> <span class="token string">'axios'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//不需要频繁更新组件提取到vendor.js</span>
    <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//开启版本号，对应mix-manifest.json;</span>
    <span class="token punctuation">.</span><span class="token function">webpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        output<span class="token operator">:</span> <span class="token punctuation">{</span>
            publicPath<span class="token operator">:</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_URL</span><span class="token operator">+</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token comment">//项目为二级目录，这个很有用</span>
            filename<span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span> <span class="token comment">//可选</span>
            chunkFilename<span class="token operator">:</span> <span class="token string">'js/chunk/[name].js?id=[chunkhash:20]'</span> <span class="token comment">//按组件打包文件，启用分包异步加载功能</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote>
<p>当项目为二级目录时，建议加上 <code>publicPath:process.env.APP_URL+'/'</code> 配置</p>
</blockquote>
<h2 id="mix-manifest-json" tabindex="-1"><a class="header-anchor" href="#mix-manifest-json" aria-hidden="true">#</a> mix-manifest.json</h2>
<p>当 mix 开启了版本号，<code>mix-manifest.json</code> 中映射的打包文件都会加上 <code>?id=d41d8cd98f00b204e980</code> 的版本号：</p>
<div class="language-javascript ext-js"><pre v-pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string">"/js/chunk//js/app.js"</span><span class="token operator">:</span> <span class="token string">"/js/chunk//js/app.js?id=deee26a25babd60a2fea"</span><span class="token punctuation">,</span>
    <span class="token string">"/css/app.css"</span><span class="token operator">:</span> <span class="token string">"/css/app.css?id=d41d8cd98f00b204e980"</span><span class="token punctuation">,</span>
    <span class="token string">"/js/manifest.js"</span><span class="token operator">:</span> <span class="token string">"/js/manifest.js?id=bba2d32dc208463ea21b"</span><span class="token punctuation">,</span>
    <span class="token string">"/js/chunk//js/vendor.js"</span><span class="token operator">:</span> <span class="token string">"/js/chunk//js/vendor.js?id=dc84a611552605e8467c"</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时就可以使用 <code>mix</code> 函数加载文件，而不用关系版本号：</p>
<div class="language-javascript ext-js"><pre v-pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"{{asset(mix('js/manifest.js'))}}"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"{{asset(mix('js/chunk//js/vendor.js'))}}"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"{{asset(mix('js/chunk//js/app.js'))}}"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre></div><p>后记，但第一次执行 <code>npm run watch-poll</code> 和 <code>npm run production</code> 出现报错：</p>
<div class="language-javascript ext-js"><pre v-pre class="language-javascript"><code>vendor<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span>dc7aa51b14b938f60dc6<span class="token operator">:</span><span class="token number">2260</span> <span class="token punctuation">[</span>vue<span class="token operator">-</span>router<span class="token punctuation">]</span> Failed to resolve <span class="token keyword">async</span> component <span class="token keyword">default</span><span class="token operator">:</span> TypeError<span class="token operator">:</span> Cannot read property <span class="token string">'call'</span> <span class="token keyword">of</span> <span class="token keyword">undefined</span>
vendor<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span>dc7aa51b14b938f60dc6<span class="token operator">:</span><span class="token number">2260</span> <span class="token punctuation">[</span>vue<span class="token operator">-</span>router<span class="token punctuation">]</span> uncaught error during route navigation<span class="token operator">:</span>
vendor<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span>dc7aa51b14b938f60dc6<span class="token operator">:</span><span class="token number">4323</span> TypeError<span class="token operator">:</span> Cannot read property <span class="token string">'call'</span> <span class="token keyword">of</span> <span class="token keyword">undefined</span>
     at <span class="token function">webpack_require</span> <span class="token punctuation">(</span>manifest<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">0</span>b8d8ed69518def5b3d0<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
     at Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_css<span class="token operator">-</span>loader@<span class="token number">1.0</span><span class="token number">.1</span>@css<span class="token operator">-</span>loader<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_vue<span class="token operator">-</span>loader@<span class="token number">15.7</span><span class="token number">.1</span>@vue<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>loaders<span class="token operator">/</span>stylePostLoader<span class="token punctuation">.</span>js<span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_postcss<span class="token operator">-</span>loader@<span class="token number">3.0</span><span class="token number">.0</span>@postcss<span class="token operator">-</span>loader<span class="token operator">/</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_vue<span class="token operator">-</span>loader@<span class="token number">15.7</span><span class="token number">.1</span>@vue<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>resources<span class="token operator">/</span>js<span class="token operator">/</span>components<span class="token operator">/</span>Slider<span class="token punctuation">.</span>vue<span class="token operator">?</span>vue<span class="token operator">&amp;</span>type<span class="token operator">=</span>style<span class="token operator">&amp;</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>id<span class="token operator">=</span><span class="token number">872262e8</span><span class="token operator">&amp;</span>scoped<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>css<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0.</span>js<span class="token operator">:</span><span class="token number">292</span><span class="token punctuation">)</span>
     at <span class="token function">webpack_require</span> <span class="token punctuation">(</span>manifest<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">0</span>b8d8ed69518def5b3d0<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
     at Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_style<span class="token operator">-</span>loader@<span class="token number">0.23</span><span class="token number">.1</span>@style<span class="token operator">-</span>loader<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_css<span class="token operator">-</span>loader@<span class="token number">1.0</span><span class="token number">.1</span>@css<span class="token operator">-</span>loader<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_vue<span class="token operator">-</span>loader@<span class="token number">15.7</span><span class="token number">.1</span>@vue<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>loaders<span class="token operator">/</span>stylePostLoader<span class="token punctuation">.</span>js<span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_postcss<span class="token operator">-</span>loader@<span class="token number">3.0</span><span class="token number">.0</span>@postcss<span class="token operator">-</span>loader<span class="token operator">/</span>src<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_vue<span class="token operator">-</span>loader@<span class="token number">15.7</span><span class="token number">.1</span>@vue<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>resources<span class="token operator">/</span>js<span class="token operator">/</span>components<span class="token operator">/</span>Slider<span class="token punctuation">.</span>vue<span class="token operator">?</span>vue<span class="token operator">&amp;</span>type<span class="token operator">=</span>style<span class="token operator">&amp;</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>id<span class="token operator">=</span><span class="token number">872262e8</span><span class="token operator">&amp;</span>scoped<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>css<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0.</span>js<span class="token operator">:</span><span class="token number">342</span><span class="token punctuation">)</span>
     at <span class="token function">webpack_require</span> <span class="token punctuation">(</span>manifest<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">0</span>b8d8ed69518def5b3d0<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
     at Module<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>resources<span class="token operator">/</span>js<span class="token operator">/</span>components<span class="token operator">/</span>Slider<span class="token punctuation">.</span>vue<span class="token operator">?</span>vue<span class="token operator">&amp;</span>type<span class="token operator">=</span>style<span class="token operator">&amp;</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token operator">&amp;</span>id<span class="token operator">=</span><span class="token number">872262e8</span><span class="token operator">&amp;</span>scoped<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>lang<span class="token operator">=</span>css<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0.</span>js<span class="token operator">:</span><span class="token number">1361</span><span class="token punctuation">)</span>
     at <span class="token function">webpack_require</span> <span class="token punctuation">(</span>manifest<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">0</span>b8d8ed69518def5b3d0<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
     at Module<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>resources<span class="token operator">/</span>js<span class="token operator">/</span>components<span class="token operator">/</span>Slider<span class="token punctuation">.</span><span class="token function">vue</span> <span class="token punctuation">(</span><span class="token number">0.</span>js<span class="token operator">:</span><span class="token number">1310</span><span class="token punctuation">)</span>
     at <span class="token function">webpack_require</span> <span class="token punctuation">(</span>manifest<span class="token punctuation">.</span>js<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">0</span>b8d8ed69518def5b3d0<span class="token operator">:</span><span class="token number">85</span><span class="token punctuation">)</span>
     at Module<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_babel<span class="token operator">-</span>loader@<span class="token number">8.0</span><span class="token number">.6</span>@babel<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>_vue<span class="token operator">-</span>loader@<span class="token number">15.7</span><span class="token number">.1</span>@vue<span class="token operator">-</span>loader<span class="token operator">/</span>lib<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">?</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>resources<span class="token operator">/</span>js<span class="token operator">/</span>pages<span class="token operator">/</span>home<span class="token operator">/</span>Index<span class="token punctuation">.</span>vue<span class="token operator">?</span>vue<span class="token operator">&amp;</span>type<span class="token operator">=</span>script<span class="token operator">&amp;</span>lang<span class="token operator">=</span>js<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">22.</span>js<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
</code></pre></div><p>经过搜索和测试，是 <code>sass('resources/sass/app.scss', 'public/css')</code>导致的，所以在没有使用到 sass 的话，这句话可以注释掉，就不会报错了。具体原因参考：<a href="https://blog.csdn.net/u011584949/article/details/89177515" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u011584949/article/details/89177515<OutboundLink/></a></p>
</template>
