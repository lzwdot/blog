---
 title: "setState 为何使用不可变值"
 ID: "29296"
 date: "2022-01-25 10:35:46"
 author: "lzw."
 categories: 
  - "frame"
  - "react-use"
 tags: 
  - "frame"
  - "react-use"
---

# setState 为何使用不可变值

- 不可变值
- 可能是异步更新
- 可能会被合并

React 中最重要的概念 setState 不可变值

## 不可变值-变量

例子

```js
// 不要直接修改 state，使用不可变数据 
// this.state.count++ // 错误
this.setState({
  count: this.state.count + 1
})
```

## 不可变值-数组

例子

```js
// 不可变值（函数式编程，纯函数） - 数组
const list5Copy = this.state.list5.slice()
list5Copy.splice(2, 0, 'a') // 中间插入/删除
this.setState({
  list1: this.state.list1.concat(100), // 追加
  list2: [...this.state.list2, 100], // 追加
  list3: this.state.list3.slice(0, 3),// 截取
  list4: this.state.list4.filter(item => item > 100), // 帅选
  list5: list5Copy //其他操作
})
// 注意，不能直接对 this.state.list 进行 push pop splice 等，这样违反不可变值
```

## 不可变值-对象

例子

```js
// 不可变值 - 对象
this.setState({
  obj1: Object.assign({}, this.state.obj1, {a: 100}),
  obj2: {...this.state.obj2, a: 100}
})
// 注意，不能直接对 this.state.obj 进行属性设置，这样违反不可变值
```



