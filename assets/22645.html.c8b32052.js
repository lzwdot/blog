import{d as t,o,c as e,a as n,e as p,F as c,g as s,h as l}from"./app.4ca8afde.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const k={},r=n("h1",{id:"h5\u5229\u7528cropper-js\u5B9E\u73B0\u56FE\u7247\u88C1\u526A",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#h5\u5229\u7528cropper-js\u5B9E\u73B0\u56FE\u7247\u88C1\u526A","aria-hidden":"true"},"#"),s(" h5\u5229\u7528cropper.js\u5B9E\u73B0\u56FE\u7247\u88C1\u526A")],-1),i=n("p",null,"\u6700\u8FD1\u4E3A\u4E86\u5B9E\u73B0h5\u56FE\u7247\u88C1\u526A\u529F\u80FD\uFF0C\u5728\u7F51\u4E0A\u67E5\u9605\u4E86\u5F88\u591A\u8D44\u6599\uFF0C\u6700\u540E\u627E\u5230cropper.js\u975E\u5E38\u597D\u7528\uFF0C\u4EE5\u6B64\u8BB0\u5F55\u4E0B\u5B9E\u73B0\u8FC7\u7A0B\uFF1A",-1),d=n("h3",{id:"\u5173\u4E8Ecropper-js",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5173\u4E8Ecropper-js","aria-hidden":"true"},"#"),s(" \u5173\u4E8Ecropper.js")],-1),g=s("cropper\u662F\u4E00\u6B3E\u4F7F\u7528\u7B80\u5355\u4E14\u529F\u80FD\u5F3A\u5927\u7684\u56FE\u7247\u526A\u88C1js\u63D2\u4EF6\u3002\u8BE5\u56FE\u7247\u526A\u88C1\u63D2\u4EF6\u652F\u6301\u56FE\u7247\u653E\u5927\u7F29\u5C0F\uFF0C\u652F\u6301\u9F20\u6807\u6EDA\u8F6E\u64CD\u4F5C\uFF0C\u652F\u6301\u56FE\u7247\u65CB\u8F6C\uFF0C\u652F\u6301\u89E6\u6478\u5C4F\u8BBE\u5907\uFF0C\u652F\u6301canvas\uFF0C\u5E76\u4E14\u652F\u6301\u8DE8\u6D4F\u89C8\u5668\u4F7F\u7528"),m=n("br",null,null,-1),f=s(" \u5B98\u65B9\u7F51\u7AD9\uFF1A"),y={href:"http://fengyuanchen.github.io/cropper/",target:"_blank",rel:"noopener noreferrer"},h=s("http://fengyuanchen.github.io/cropper/"),b=l(`<h2 id="\u524D\u7AEF\u56FE\u7247\u88C1\u526A\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u524D\u7AEF\u56FE\u7247\u88C1\u526A\u5904\u7406" aria-hidden="true">#</a> \u524D\u7AEF\u56FE\u7247\u88C1\u526A\u5904\u7406</h2><ol><li>\u5F15\u5165cropper\u6587\u4EF6\uFF0C\u521D\u59CB\u5316\u6587\u6863\u7ED3\u6784</li></ol><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;./cropper.min.css&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u6587\u4EF6\u4E0A\u4F20<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;js-uploadfile&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u786E\u5B9A\u88C1\u526A<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;js-ok&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;\u88C1\u526A&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>cropper\u57FA\u672C\u7ED3\u6784<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;container js-container&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;js-image&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>\u88C1\u526A\u7ED3\u679C\u663E\u793A<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;js-result&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./jquery-1.10.1.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./cropper.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token comment">//\u5176\u4ED6js\u4EE3\u7801&lt;/script&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span> 
</code></pre></div><p>\u4EE5\u4E0A\u4EE3\u7801\u5305\u542B\u6587\u4EF6\u4E0A\u4F20\uFF0C\u88C1\u526A\u6309\u94AE\u548Ccropper\u57FA\u672C\u7ED3\u6784\uFF0C\u6253\u597D\u7ED3\u6784\u67B6\u5B50\uFF0C\u4E0B\u9762\u5C31\u662F\u529F\u80FD\u7684\u5B9E\u73B0</p><ol><li>\u6838\u5FC3js\u4EE3\u7801\uFF0C\u5B9E\u73B0\u529F\u80FD\u6709\uFF1A</li></ol><ul><li>\u6587\u4EF6\u4E0A\u4F20</li><li>\u56FE\u7247\u88C1\u526A</li><li>\u56FE\u7247\u63D0\u4EA4</li></ul><p>\u6839\u636Einput[type=file]\u7684\u503C\u53D8\u5316\u83B7\u53D6\u56FE\u7247\u7684base64\u6587\u4EF6\u4FE1\u606F</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">var</span> cropper<span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.js-uploadfile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">/</span>image<span class="token operator">/</span>w<span class="token operator">+</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showTips</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;\u4E0D\u662F\u56FE\u7247\u6587\u4EF6\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showTips</span><span class="token punctuation">(</span><span class="token string">&#39;\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC72M&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fr<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u8FD9\u91CC\u521D\u59CB\u5316cropper</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;.js-image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span>fr<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">iniCropper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>\u7136\u540E\u521D\u59CB\u5316cropper\uFF0C\u53C2\u6570\u89E3\u91CA\u53C2\u8003\u5B98\u65B9\u6587\u6863</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">var</span> croppable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">iniCropper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> $image <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;.js-image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        image <span class="token operator">=</span> $image<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    cropper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cropper</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">dragMode</span><span class="token operator">:</span> <span class="token string">&#39;move&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">aspectRatio</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">autoCropArea</span><span class="token operator">:</span> <span class="token number">0.65</span><span class="token punctuation">,</span>
        <span class="token literal-property property">restore</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">viewMode</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">guides</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">highlight</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cropBoxMovable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cropBoxResizable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">toggleDragModeOnDblclick</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token function-variable function">ready</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            croppable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>\u5B9E\u73B0\u88C1\u526A\uFF0C\u5E76\u4E0A\u4F20\u56FE\u7247\u3002\u8FD9\u91CC\u9700\u8981\u8C03\u7528\u4E24\u4E2A\u51FD\u6570getRectCanvas\uFF0CconvertBase64UrlToBlob\uFF1A<br> getRectCanvas\uFF1A\u7528\u4E8E\u7ED8\u5236\u77E9\u5F62Canvas\uFF0C<br> convertBase64UrlToBlob\uFF1A\u5C06\u4EE5base64\u7684\u56FE\u7247url\u6570\u636E\u8F6C\u6362\u4E3ABlob</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;.js-ok&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> croppedCanvas<span class="token punctuation">;</span>
    <span class="token keyword">var</span> rectCanvas<span class="token punctuation">;</span>
    <span class="token keyword">var</span> rectImage<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>croppable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Crop</span>
    croppedCanvas <span class="token operator">=</span> cropper<span class="token punctuation">.</span><span class="token function">getCroppedCanvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Rect</span>
    rectCanvas <span class="token operator">=</span> <span class="token function">getRectCanvas</span><span class="token punctuation">(</span>croppedCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Show</span>
    rectImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rectImage<span class="token punctuation">.</span>src <span class="token operator">=</span> rectCanvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#39;.js-result&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>rectImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//var form=document.forms[0];</span>
    <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//\u8FD9\u91CC\u8FDE\u5E26form\u91CC\u7684\u5176\u4ED6\u53C2\u6570\u4E5F\u4E00\u8D77\u63D0\u4EA4\u4E86,\u5982\u679C\u4E0D\u9700\u8981\u63D0\u4EA4\u5176\u4ED6\u53C2\u6570\u53EF\u4EE5\u76F4\u63A5FormData\u65E0\u53C2\u6570\u7684\u6784\u9020\u51FD\u6570</span>
    <span class="token comment">//convertBase64UrlToBlob\u51FD\u6570\u662F\u5C06base64\u7F16\u7801\u8F6C\u6362\u4E3ABlob</span>
    formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">,</span> <span class="token function">convertBase64UrlToBlob</span><span class="token punctuation">(</span>rectCanvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//append\u51FD\u6570\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570\u662F\u540E\u53F0\u83B7\u53D6\u6570\u636E\u7684\u53C2\u6570\u540D,\u548Chtml\u6807\u7B7E\u7684input\u7684name\u5C5E\u6027\u529F\u80FD\u76F8\u540C</span>
    <span class="token comment">//ajax \u63D0\u4EA4form</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//\u4E0D\u63D0\u4EA4</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>         <span class="token comment">// \u544A\u8BC9jQuery\u4E0D\u8981\u53BB\u5904\u7406\u53D1\u9001\u7684\u6570\u636E</span>
        <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// \u544A\u8BC9jQuery\u4E0D\u8981\u53BB\u8BBE\u7F6EContent-Type\u8BF7\u6C42\u5934</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">showTips</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&#39;url?t=&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">xhr</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//\u5728jquery\u51FD\u6570\u4E2D\u76F4\u63A5\u4F7F\u7528ajax\u7684XMLHttpRequest\u5BF9\u8C61</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;progress&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> percentComplete <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">/</span> evt<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6B63\u5728\u63D0\u4EA4...&quot;</span> <span class="token operator">+</span> percentComplete<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;%&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//\u5728\u63A7\u5236\u53F0\u6253\u5370\u4E0A\u4F20\u8FDB\u5EA6</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> xhr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>\u529F\u80FD\u51FD\u6570: getRectCanvas\uFF1A\u7528\u4E8E\u7ED8\u5236\u77E9\u5F62Canvas\uFF0C<br> convertBase64UrlToBlob\uFF1A\u5C06\u4EE5base64\u7684\u56FE\u7247url\u6570\u636E\u8F6C\u6362\u4E3ABlob</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">//\u7ED8\u5236\u77E9\u5F62canvas</span>
<span class="token keyword">function</span> <span class="token function">getRectCanvas</span><span class="token punctuation">(</span><span class="token parameter">sourceCanvas</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> width <span class="token operator">=</span> sourceCanvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> sourceCanvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>imageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>sourceCanvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>globalCompositeOperation <span class="token operator">=</span> <span class="token string">&#39;destination-in&#39;</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> canvas<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* \u5C06\u4EE5base64\u7684\u56FE\u7247url\u6570\u636E\u8F6C\u6362\u4E3ABlob
* <span class="token keyword">@param</span> <span class="token parameter">urlData</span>
* \u7528url\u65B9\u5F0F\u8868\u793A\u7684base64\u56FE\u7247\u6570\u636E
*/</span>
<span class="token keyword">function</span> <span class="token function">convertBase64UrlToBlob</span><span class="token punctuation">(</span><span class="token parameter">urlData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bytes <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>urlData<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//\u53BB\u6389url\u7684\u5934\uFF0C\u5E76\u8F6C\u6362\u4E3Abyte</span>
    <span class="token comment">//\u5904\u7406\u5F02\u5E38,\u5C06ascii\u7801\u5C0F\u4E8E0\u7684\u8F6C\u6362\u4E3A\u5927\u4E8E0</span>
    <span class="token keyword">var</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ia <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ia<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ab<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;image/png&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><h2 id="\u540E\u7AEFphp\u63A5\u6536\u88C1\u526A\u56FE\u7247\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u540E\u7AEFphp\u63A5\u6536\u88C1\u526A\u56FE\u7247\u6570\u636E" aria-hidden="true">#</a> \u540E\u7AEFphp\u63A5\u6536\u88C1\u526A\u56FE\u7247\u6570\u636E</h2><p>\u63A5\u6536\u6570\u636E\u5206\u4E24\u79CD\u60C5\u51B5\uFF1A</p><ol><li>\u63A5\u6536Blob\u6587\u4EF6\u6570\u636E</li></ol><div class="language-javascript ext-js"><pre class="language-javascript"><code>$filename <span class="token operator">=</span> $_FILES<span class="token punctuation">[</span><span class="token string">&#39;filename&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">move_uploaded_file</span><span class="token punctuation">(</span>$filename<span class="token punctuation">[</span><span class="token string">&#39;tmp_name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&#39;./&#39;</span><span class="token punctuation">.</span>$filename<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;status&#39;</span><span class="token operator">=&gt;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;msg&#39;</span><span class="token operator">=&gt;</span><span class="token string">&#39;\u5934\u50CF\u4E0A\u4F20\u6210\u529F&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><ol><li>\u63A5\u6536base64\u6587\u4EF6\u6570\u636E</li></ol><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Content-type:text/html;charset=utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$base64_image_content <span class="token operator">=</span> $_FILES<span class="token punctuation">[</span><span class="token string">&#39;filename&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//\u4FDD\u5B58base64\u5B57\u7B26\u4E32\u4E3A\u56FE\u7247</span>
<span class="token comment">//\u5339\u914D\u51FA\u56FE\u7247\u7684\u683C\u5F0F</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">&#39;/^(data:s*image/(w+);base64,)/&#39;</span><span class="token punctuation">,</span> $base64_image_content<span class="token punctuation">,</span> $result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $type <span class="token operator">=</span> $result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    $new_file <span class="token operator">=</span> <span class="token string">&quot;./test.{$type}&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span>$new_file<span class="token punctuation">,</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">str_replace</span><span class="token punctuation">(</span>$result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> $base64_image_content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        echo <span class="token string">&#39;\u65B0\u6587\u4EF6\u4FDD\u5B58\u6210\u529F\uFF1A&#39;</span><span class="token punctuation">,</span>
        $new_file<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>\u597D\u4E86\u5927\u544A\u6210\u529F\uFF0C\u4EE5\u4E0A\u5C31\u662Fh5\u5229\u7528cropper.js\u5B9E\u73B0\u56FE\u7247\u88C1\u526A\u5B9E\u73B0\u8FC7\u7A0B</p><blockquote><p>demo\u548C\u6E90\u7801</p></blockquote>`,22),v=s("demo:\xA0"),w={href:"https://lzwdot.github.io/html/cropperjs-demo/index.html",target:"_blank",rel:"noopener noreferrer"},_=s("https://lzwdot.github.io/html/cropperjs-demo/index.html"),j=n("br",null,null,-1),q=s(" \u6E90\u7801\uFF1A"),x={href:"https://github.com/lzwdot/html/tree/master/swiper-demo",target:"_blank",rel:"noopener noreferrer"},C=s("https://github.com/lzwdot/html/tree/master/swiper-demo");function B($,T){const a=t("ExternalLinkIcon");return o(),e(c,null,[r,i,d,n("blockquote",null,[n("p",null,[g,m,f,n("a",y,[h,p(a)])])]),b,n("p",null,[v,n("a",w,[_,p(a)]),j,q,n("a",x,[C,p(a)])])],64)}var L=u(k,[["render",B]]);export{L as default};
