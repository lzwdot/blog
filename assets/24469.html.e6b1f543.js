import{d as p,o,c as e,a as s,e as c,F as l,h as n,g as a}from"./app.4ca8afde.js";import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";const u={},i=n(`<h1 id="\u5B9D\u5854-ecs-\u914D\u7F6E\u8D1F\u8F7D\u5747\u8861-slb-\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u5B9D\u5854-ecs-\u914D\u7F6E\u8D1F\u8F7D\u5747\u8861-slb-\u7684\u95EE\u9898" aria-hidden="true">#</a> \u5B9D\u5854 ecs \u914D\u7F6E\u8D1F\u8F7D\u5747\u8861 slb \u7684\u95EE\u9898</h1><p>\u5728\u914D\u7F6E slb \u5065\u5EB7\u68C0\u67E5\u975E\u5E38\u91CD\u8981\uFF0C\u5982\u679C\u51FA\u73B0\u4EE5\u4E0B\u60C5\u51B5</p><blockquote><p>\u4E0B\u8FF0\u539F\u56E0\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5065\u5EB7\u68C0\u67E5\u5F02\u5E38\uFF1A<br> iptables \u9632\u706B\u5899\u914D\u7F6E\u5F00\u542F<br> \u540E\u7AEF http \u63A2\u6D4B\u7801401\u3001403\u4E0E\u914D\u7F6E\u4E0D\u5339\u914D</p></blockquote><p><strong>1\u3001\u5173\u95ED iptables\u670D\u52A1</strong>\uFF0C centOS 7 \u9ED8\u8BA4\u7528\u7684\u662F firewalld\uFF0C\u4E5F\u662F\u57FA\u4E8E iptables \u7684\uFF0C\u4F46 iptables \u670D\u52A1\u662F\u6CA1\u5B89\u88C5\u7684</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>#\u5F00\u542F\u9632\u706B\u5899\uFF0C\u5E76\u542F\u7528\u8FD9\u4E2A\u670D\u52A1
sudo systemctl enable firewalld<span class="token punctuation">.</span>service
sudo systemctl start firewalld<span class="token punctuation">.</span>service
#\u505C\u6B62\u9632\u706B\u5899\uFF0C\u5E76\u7981\u7528\u8FD9\u4E2A\u670D\u52A1
sudo systemctl stop firewalld<span class="token punctuation">.</span>service
sudo systemctl disable firewalld<span class="token punctuation">.</span>service
</code></pre></div><p>\u5982\u679C\u60F3\u5728 centOS 7 \u6539\u7528 iptables \u7684\u8BDD\uFF0C\u9700\u8981\u5B89\u88C5 iptables \u670D\u52A1</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>#\u5B89\u88C5
sudo yum install iptables<span class="token operator">-</span>services
#\u5F00\u542Fiptables
sudo systemctl enable iptables
sudo systemctl enable ip6tables
#\u542F\u52A8\u670D\u52A1
sudo systemctl start iptables
sudo systemctl start ip6tables
</code></pre></div><p><strong>2\u3001\u5982\u679C\u662F\u5B9D\u5854\u9762\u677F</strong>\u7684 ecs \u670D\u52A1\u5668\uFF0C\u4E00\u822C\u76D1\u542C 80 \u7AEF\u53E3\u65F6\uFF0C\u6700\u5BB9\u6613\u53D1\u751F\u5F02\u5E38\uFF0C\u539F\u56E0\u8FD8\u662F\u670D\u52A1\u5668 nginx \u914D\u7F6E\u95EE\u9898\uFF0C\u51C6\u786E\u7684\u8BF4\u5B89\u88C5 phpmyadmin \u7684\u95EE\u9898\u3002\u5F53\u542F\u52A8\u548C\u505C\u6B62 phpmyadmin \u65F6\uFF0C \u67E5\u770B nginx \u914D\u7F6E\u6587\u4EF6 <code>root</code> \u914D\u7F6E\u9879\u4F1A\u6307\u5411 <code>root /www/server/phpmyadmin;</code> \u6216 <code>root /www/server/stop;</code> \u7AEF\u53E3\u4E5F\u4F1A\u8DDF\u968F phpmyadmin \u914D\u7F6E\u4E00\u8D77\u53D8\u5316\u3002\u597D\u4E86\uFF0C\u95EE\u9898\u627E\u5230\u4E86\uFF0C\u90A3\u4E48\u600E\u4E48\u89E3\u51B3\uFF1F</p><blockquote><p><strong>\u66F4\u65B0\uFF1A\u6700\u5FEB\u65B9\u5F0F\u5C31\u662F\u5728\u5B9D\u5854\u91CC\u8BBE\u7F6E\u9ED8\u8BA4\u7AD9\u70B9\u5373\u53EF\uFF0C\u4E0B\u9762\u7684\u4E0D\u7528\u770B\u4E86</strong></p></blockquote><p><strong>\u6700\u5FEB\u6377\u65B9\u5F0F</strong>\uFF0C\u624B\u52A8\u4FEE\u6539 nginx \u914D\u7F6E\u6587\u4EF6\u76D1\u542C\u7AEF\u53E3 80\uFF0Croot \u6307\u5411 <code>/www/wwwroot/default/</code>\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u4E0D\u80FD\u518D\u4F7F\u7528 phpmyadmin</p><p><strong>\u65B0\u5EFA\u914D\u7F6E\u6587\u4EF6\u65B9\u5F0F</strong>\uFF0C\u5728 <code>/www/server/panel/vhost</code> \u76EE\u5F55\u65B0\u5EFA <code>nginx_slb.conf</code> \u6587\u4EF6\uFF0C\u6DFB\u52A0\u914D\u7F6E</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>server
  <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name slb<span class="token punctuation">;</span>
    index index<span class="token punctuation">.</span>php index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm <span class="token keyword">default</span><span class="token punctuation">.</span>php <span class="token keyword">default</span><span class="token punctuation">.</span>htm <span class="token keyword">default</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    root  <span class="token operator">/</span>www<span class="token operator">/</span>wwwroot<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">;</span>
    #error_page   <span class="token number">404</span>   <span class="token operator">/</span><span class="token number">404</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    include enable<span class="token operator">-</span>php<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>
    location <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>swf<span class="token punctuation">)</span>$
      <span class="token punctuation">{</span>
      expires      30d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">~</span> <span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">(</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span><span class="token operator">?</span>$
      <span class="token punctuation">{</span>
      expires      12h<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">~</span> <span class="token operator">/</span><span class="token punctuation">.</span>
      <span class="token punctuation">{</span>
      deny all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">/</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">-</span>e $request_filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         rewrite <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">public</span><span class="token operator">/</span> <span class="token operator">/</span>$1<span class="token operator">/</span><span class="token keyword">public</span><span class="token operator">/</span>index<span class="token punctuation">.</span>php<span class="token operator">?</span>$query_string last<span class="token punctuation">;</span> #\u63A8\u8350
         <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    access_log  <span class="token operator">/</span>www<span class="token operator">/</span>wwwlogs<span class="token operator">/</span>slb<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
    error_log  <span class="token operator">/</span>www<span class="token operator">/</span>wwwlogs<span class="token operator">/</span>slb<span class="token punctuation">.</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
</code></pre></div><p>\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u5728 nginx \u914D\u7F6E\u6587\u4EF6\u4E2D phpmyadmin \u7684 server <strong>\u524D\u9762</strong>\u5F15\u5165\u5373\u53EF</p><div class="language-javascript ext-js"><pre class="language-javascript"><code> server_tokens off<span class="token punctuation">;</span>
        access_log off<span class="token punctuation">;</span>
include <span class="token operator">/</span>www<span class="token operator">/</span>server<span class="token operator">/</span>panel<span class="token operator">/</span>vhost<span class="token operator">/</span>nginx_slb<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>
server
    <span class="token punctuation">{</span>
        listen <span class="token number">888</span><span class="token punctuation">;</span>
        server_name phpmyadmin<span class="token punctuation">;</span> 
</code></pre></div><p>3\u3001<strong>https \u91CD\u5B9A\u5411\u7684\u6B21\u6570\u8FC7\u591A</strong>\uFF0C\u8FD9\u662F\u7AEF\u670D\u52A1\u5668\u7AEF\u53E3\u914D\u7F6E\u95EE\u9898\uFF0C \u4FEE\u6539\u7AEF\u53E3\u4E3A 80\uFF0C\u4F7F slb \u4E0E ecs \u670D\u52A1\u5668\u4E4B\u95F4\u901A\u8FC7 http \u8F6C\u53D1\u3002\u5982\u679C\u9875\u9762\u6837\u5F0F\u9519\u4E71\uFF0C \u5219\u5C06 http \u8C03\u7528\u6539\u4E3A\u4E86https \uFF0C\u5728\u9875\u9762\u6DFB\u52A0</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;Content-Security-Policy&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;upgrade-insecure-requests&quot;</span><span class="token operator">&gt;</span>
</code></pre></div>`,16),k=a("\u53C2\u8003\uFF1A "),d={href:"https://blog.csdn.net/zhangyongbink/article/details/86636014",target:"_blank",rel:"noopener noreferrer"},g=a("https://blog.csdn.net/zhangyongbink/article/details/86636014"),w=n(`<p>\u5982\u679C\u662F laravel \u5E94\u7528\uFF0C\u5219\u5728 <code>AppServiceProvider</code> \u7684 <code>boot()</code> \u65B9\u6CD5\u4E2D\u6DFB\u52A0\u4EE5\u4E0B\u4EE3\u7801\uFF08\u6CE8\u610F\uFF1A\u9700\u8981\u5728 slb \u9AD8\u7EA7\u914D\u7F6E\u91CC\u52FE\u9009\u201C \u901A\u8FC7X-Forwarded-Proto\u5934\u5B57\u6BB5\u83B7\u53D6SLB\u7684\u76D1\u542C\u534F\u8BAE \u201D\uFF09</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>app<span class="token punctuation">[</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">&gt;</span>server<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;HTTPS&#39;</span><span class="token punctuation">,</span> <span class="token function">isset</span><span class="token punctuation">(</span>$_SERVER<span class="token punctuation">[</span><span class="token string">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;https&#39;</span> <span class="token operator">==</span> $_SERVER<span class="token punctuation">[</span><span class="token string">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>`,2);function b(m,v){const t=p("ExternalLinkIcon");return o(),e(l,null,[i,s("blockquote",null,[s("p",null,[k,s("a",d,[g,c(t)])])]),w],64)}var f=r(u,[["render",b]]);export{f as default};
