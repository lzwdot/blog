import{d as o,o as p,c as t,a as s,e as r,F as c,h as n,g as a}from"./app.4ca8afde.js";import{_ as l}from"./plugin-vue_export-helper.21dcd24c.js";const i={},u=n(`<h1 id="supervisor\u5B89\u88C5\u914D\u7F6E\u4EE5\u53CAlaravel\u961F\u5217\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#supervisor\u5B89\u88C5\u914D\u7F6E\u4EE5\u53CAlaravel\u961F\u5217\u8BBE\u7F6E" aria-hidden="true">#</a> supervisor\u5B89\u88C5\u914D\u7F6E\u4EE5\u53CALaravel\u961F\u5217\u8BBE\u7F6E</h1><h3 id="\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a> \u5B89\u88C5</h3><p>\u65B9\u6CD51\uFF1A\u5148\u5B89\u88C5 Python \u7684 <code>easy_install</code>\uFF0C\u518D\u901A\u8FC7 easy_install \u5B89\u88C5 supervisor</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># yum install python<span class="token operator">-</span>setuptools
# easy_install supervisor
</code></pre></div><p>\u65B9\u6CD52\uFF1A\u4F7F\u7528pip\u5B89\u88C5</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># sudo pip install supervisor
</code></pre></div><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h3><p>\u751F\u6210\u914D\u7F6E\u6587\u4EF6\uFF0C\u5E76\u5EFA\u7ACB\u76F8\u5E94\u76EE\u5F55\uFF0C\u7BA1\u7406 supervisor \u542F\u52A8\u8FDB\u7A0B</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># echo_supervisord_conf <span class="token operator">&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>supervisord<span class="token punctuation">.</span>conf
# mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>supervisor<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>
</code></pre></div><p>\u7F16\u8F91 <code>/etc/supervisord.conf</code>\uFF0C\u4FEE\u6539 [include] \uFF08<strong>\u6CE8\u610F[include]\u524D\u9762\u7684\u201D;\u201D\u4E5F\u8981\u53BB\u6389</strong>\uFF09\u533A\u5757\u5185\u5BB9\uFF1A</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token punctuation">[</span>include<span class="token punctuation">]</span>
files <span class="token operator">=</span> <span class="token operator">/</span>etc<span class="token operator">/</span>supervisor<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token comment">/*.conf
</span></code></pre></div><p>\u8FD9\u6837\uFF0C supervisor \u4F1A\u52A0\u8F7D /etc/supervisor/conf.d/ \u4E0B\u7684\u6240\u6709 .conf \u6587\u4EF6</p><h3 id="\u81EA\u52A8\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u81EA\u52A8\u542F\u52A8" aria-hidden="true">#</a> \u81EA\u52A8\u542F\u52A8</h3>`,13),d=a("\u5728 "),k={href:"https://github.com/Supervisor/initscripts",target:"_blank",rel:"noopener noreferrer"},v=a("https://github.com/Supervisor/initscripts"),g=a(" \u4E0B\u8F7D CentOS \u4F7F\u7528\u7684\u81EA\u52A8\u542F\u52A8\u670D\u52A1\u811A\u672C "),h=s("code",null,"centos-systemd-etcs",-1),_=n(`<div class="language-javascript ext-js"><pre class="language-javascript"><code># wget <span class="token operator">-</span><span class="token constant">O</span> <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>supervisord<span class="token punctuation">.</span>service  https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>Supervisor<span class="token operator">/</span>initscripts<span class="token operator">/</span>raw<span class="token operator">/</span>master<span class="token operator">/</span>centos<span class="token operator">-</span>systemd<span class="token operator">-</span>etcs
</code></pre></div><p>\u5C06 <code>supervisord</code> \u670D\u52A1\u8BBE\u4E3A\u81EA\u542F\u52A8</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># systemctl enable supervisord<span class="token punctuation">.</span>service
</code></pre></div><p>\u8F93\u5165 supervisorctl \u547D\u4EE4\u53EF\u4EE5\u8FDB\u5165 supervisor \u63A7\u5236\u53F0</p><h3 id="\u8BBE\u7F6E-laravel-\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E-laravel-\u961F\u5217" aria-hidden="true">#</a> \u8BBE\u7F6E Laravel \u961F\u5217</h3><p>\u65B0\u5EFA <code>/etc/supervisor/conf.d/laravel-work.conf</code> \u6587\u4EF6\uFF1A</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token punctuation">[</span>program<span class="token operator">:</span>laravel<span class="token operator">-</span>worker<span class="token punctuation">]</span>
process_name<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">(</span>program_name<span class="token punctuation">)</span>s_<span class="token operator">%</span><span class="token punctuation">(</span>process_num<span class="token punctuation">)</span>02d
command<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>php<span class="token operator">/</span>bin<span class="token operator">/</span>php <span class="token operator">/</span>data<span class="token operator">/</span>wwwroot<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>artisan queue<span class="token operator">:</span>work database <span class="token operator">--</span>sleep<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">--</span>tries<span class="token operator">=</span><span class="token number">3</span> <span class="token operator">--</span>daemon
autostart<span class="token operator">=</span><span class="token boolean">true</span>
autorestart<span class="token operator">=</span><span class="token boolean">true</span>
user<span class="token operator">=</span>www
numprocs<span class="token operator">=</span><span class="token number">8</span>
redirect_stderr<span class="token operator">=</span><span class="token boolean">true</span>
stdout_logfile<span class="token operator">=</span><span class="token operator">/</span>data<span class="token operator">/</span>wwwroot<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>storage<span class="token operator">/</span>logs<span class="token operator">/</span>queue<span class="token punctuation">.</span>log
</code></pre></div><p>\u8FD9\u91CC\u5F00\u542F\u4E86 8 \u4E2A queue:work \u8FDB\u7A0B\uFF0C\u5E76\u76D1\u89C6\u4ED6\u4EEC\uFF0C\u5982\u679C\u5931\u8D25\u7684\u8BDD\uFF0C\u81EA\u52A8\u91CD\u542F\uFF1B\u5728\u9879\u76EE\u7684 storage/logs/queue.log \u8BB0\u5F55\u65E5\u5FD7\u3002</p><p>\u542F\u52A8 supervisor \u670D\u52A1\uFF1A</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># supervisord
</code></pre></div><p>\u81F3\u6B64\uFF0C supervisor \u5B89\u88C5\u53CA Laravel \u961F\u5217\u8BBE\u7F6E\u5B8C\u6BD5</p><p>\u5982\u679C\u4EE5\u540E\u914D\u7F6E\u6587\u4EF6\u6709\u4FEE\u6539\uFF0C\u6216\u8005\u65B0\u589E\uFF0C\u8FDB\u5165 supervisor \u63A7\u5236\u53F0\uFF0C\u6267\u884C\u4E0B\u9762\u7684\u547D\u4EE4</p><div class="language-javascript ext-js"><pre class="language-javascript"><code># supervisorctl
supervisorctl<span class="token operator">&gt;</span> reread
supervisorctl<span class="token operator">&gt;</span> update
supervisorctl<span class="token operator">&gt;</span> start laravel<span class="token operator">-</span>worker<span class="token operator">:</span><span class="token operator">*</span>
\u6216\u8005
# supervisorctl reread
# supervisorctl update
# supervisorctl start laravel<span class="token operator">-</span>worker<span class="token operator">:</span><span class="token operator">*</span>
</code></pre></div>`,13);function m(j,f){const e=o("ExternalLinkIcon");return p(),t(c,null,[u,s("p",null,[d,s("a",k,[v,r(e)]),g,h]),_],64)}var w=l(i,[["render",m]]);export{w as default};
