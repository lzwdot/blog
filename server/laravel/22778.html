<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="stylesheet" href="//unpkg.com/element-ui@2.15.5/lib/theme-chalk/index.css"><link rel="apple-touch-icon" sizes="180x180" href="/blog/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/favicon-16x16.png"><link rel="manifest" href="/blog/site.webmanifest"><link rel="mask-icon" href="/blog/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><script>var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?96d91412aff9543cd8e022f381d8bf1c";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();</script><title>Laravel MongoDB文档 | Lzw's 笔记</title><meta name="description" content="记录和分享，每天进步一点点！">
    <link rel="modulepreload" href="/blog/assets/app.4ca8afde.js"><link rel="modulepreload" href="/blog/assets/22778.html.3fb280ee.js"><link rel="modulepreload" href="/blog/assets/22778.html.b27060bf.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/blog/assets/style.1c838ac8.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><span class="site-name">Lzw&#39;s 笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/pages/category" class="" aria-label="分类"><!--[--><!--]--> 分类 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/pages/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://lzwdot.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub主页"><!--[--><!--]--> GitHub主页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/pages/category" class="" aria-label="分类"><!--[--><!--]--> 分类 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/pages/about" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://lzwdot.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub主页"><!--[--><!--]--> GitHub主页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Laravel <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/server/laravel/15545.html" class="sidebar-item" aria-label="Laravel从已有数据库表生成对应的migration和seed文件"><!--[--><!--]--> Laravel从已有数据库表生成对应的migration和seed文件 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/20070.html" class="sidebar-item" aria-label="最简单易懂的Laravel事件系统案例"><!--[--><!--]--> 最简单易懂的Laravel事件系统案例 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/21907.html" class="sidebar-item" aria-label="Laravel+Mongodb日志管理系统"><!--[--><!--]--> Laravel+Mongodb日志管理系统 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22648.html" class="sidebar-item" aria-label="Laravel创建.env文件"><!--[--><!--]--> Laravel创建.env文件 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22672.html" class="sidebar-item" aria-label="Laravel对get请求进行csrf检验"><!--[--><!--]--> Laravel对get请求进行csrf检验 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22704.html" class="sidebar-item" aria-label="Laravel 5.5添加自定义表单验证规则"><!--[--><!--]--> Laravel 5.5添加自定义表单验证规则 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22773.html" class="sidebar-item" aria-label="Laravel Entrust中文说明"><!--[--><!--]--> Laravel Entrust中文说明 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Laravel MongoDB文档"><!--[--><!--]--> Laravel MongoDB文档 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/server/laravel/22778.html#安装-installation" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装（Installation）"><!--[--><!--]--> 安装（Installation） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/server/laravel/22778.html#laravel版兼容性" class="router-link-active router-link-exact-active sidebar-item" aria-label="Laravel版兼容性"><!--[--><!--]--> Laravel版兼容性 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#升级-upgrading" class="router-link-active router-link-exact-active sidebar-item" aria-label="升级（Upgrading）"><!--[--><!--]--> 升级（Upgrading） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#测试-testing" class="router-link-active router-link-exact-active sidebar-item" aria-label="测试（Testing）"><!--[--><!--]--> 测试（Testing） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#配置-configuration" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置（Configuration）"><!--[--><!--]--> 配置（Configuration） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#eloquent" class="router-link-active router-link-exact-active sidebar-item" aria-label="Eloquent"><!--[--><!--]--> Eloquent <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#可选-别名-optional-alias" class="router-link-active router-link-exact-active sidebar-item" aria-label="可选：别名（Optional: Alias）"><!--[--><!--]--> 可选：别名（Optional: Alias） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#查询生成器-query-builder" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询生成器（Query Builder）"><!--[--><!--]--> 查询生成器（Query Builder） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#架构-schema" class="router-link-active router-link-exact-active sidebar-item" aria-label="架构（Schema）"><!--[--><!--]--> 架构（Schema） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/server/laravel/22778.html#地理空间索引-geospatial" class="router-link-active router-link-exact-active sidebar-item" aria-label="地理空间索引（geospatial ）"><!--[--><!--]--> 地理空间索引（geospatial ） <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#扩展-extensions" class="router-link-active router-link-exact-active sidebar-item" aria-label="扩展（Extensions）"><!--[--><!--]--> 扩展（Extensions） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/server/laravel/22778.html#验证" class="router-link-active router-link-exact-active sidebar-item" aria-label="验证"><!--[--><!--]--> 验证 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#队列" class="router-link-active router-link-exact-active sidebar-item" aria-label="队列"><!--[--><!--]--> 队列 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#sentry" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sentry"><!--[--><!--]--> Sentry <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#sessions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sessions"><!--[--><!--]--> Sessions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#例子-examples" class="router-link-active router-link-exact-active sidebar-item" aria-label="例子（Examples）"><!--[--><!--]--> 例子（Examples） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/server/laravel/22778.html#基本用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="基本用法"><!--[--><!--]--> 基本用法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#mongodb特定的操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="MongoDB特定的操作"><!--[--><!--]--> MongoDB特定的操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#inserts-updates-and-deletes" class="router-link-active router-link-exact-active sidebar-item" aria-label="Inserts, updates and deletes"><!--[--><!--]--> Inserts, updates and deletes <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#日期" class="router-link-active router-link-exact-active sidebar-item" aria-label="日期"><!--[--><!--]--> 日期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="关系"><!--[--><!--]--> 关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#embedsmany-relations" class="router-link-active router-link-exact-active sidebar-item" aria-label="EmbedsMany Relations"><!--[--><!--]--> EmbedsMany Relations <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#embedsone-relations" class="router-link-active router-link-exact-active sidebar-item" aria-label="EmbedsOne Relations"><!--[--><!--]--> EmbedsOne Relations <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#mysql关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="MySQL关系"><!--[--><!--]--> MySQL关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#原始表达" class="router-link-active router-link-exact-active sidebar-item" aria-label="原始表达"><!--[--><!--]--> 原始表达 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#mongodb的具体操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="MongoDB的具体操作"><!--[--><!--]--> MongoDB的具体操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#查询缓存-query-caching" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询缓存(Query Caching)"><!--[--><!--]--> 查询缓存(Query Caching) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/server/laravel/22778.html#查询记录-query-logging" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询记录(Query Logging)"><!--[--><!--]--> 查询记录(Query Logging) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/blog/server/laravel/22793.html" class="sidebar-item" aria-label="Laravel5.5 Blade模板-@yield @section @show @stop @append @overwrite标签区别"><!--[--><!--]--> Laravel5.5 Blade模板-@yield @section @show @stop @append @overwrite标签区别 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22837.html" class="sidebar-item" aria-label="Laravel扩展包生成器"><!--[--><!--]--> Laravel扩展包生成器 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/22849.html" class="sidebar-item" aria-label="Laravel 本地扩展包开发详细过程"><!--[--><!--]--> Laravel 本地扩展包开发详细过程 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/23710.html" class="sidebar-item" aria-label="laravel-mix配置vue的懒加载"><!--[--><!--]--> laravel-mix配置vue的懒加载 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/24287.html" class="sidebar-item" aria-label="Laravel 正确的注销方式"><!--[--><!--]--> Laravel 正确的注销方式 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/24409.html" class="sidebar-item" aria-label="Laravel 显示 “419 | Page Expired” 的几种情况"><!--[--><!--]--> Laravel 显示 “419 | Page Expired” 的几种情况 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/24435.html" class="sidebar-item" aria-label="Laravel Passport &amp;amp; 微信小程序的登录认证"><!--[--><!--]--> Laravel Passport &amp;amp; 微信小程序的登录认证 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/24449.html" class="sidebar-item" aria-label="Laravel 修改默认 view 模版路径"><!--[--><!--]--> Laravel 修改默认 view 模版路径 <!--[--><!--]--></a><!----></li><li><a href="/blog/server/laravel/24451.html" class="sidebar-item" aria-label="Laravel 5.5.42 版本后 ErrorException (E_WARNING) openssl_encrypt() 的问题"><!--[--><!--]--> Laravel 5.5.42 版本后 ErrorException (E_WARNING) openssl_encrypt() 的问题 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="laravel-mongodb文档" tabindex="-1"><a class="header-anchor" href="#laravel-mongodb文档" aria-hidden="true">#</a> Laravel MongoDB文档</h1><blockquote><p>GitHub：<a href="https://github.com/jenssegers/laravel-mongodb" target="_blank" rel="noopener noreferrer">https://github.com/jenssegers/laravel-mongodb<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></blockquote><p>一个支持MongoDB的Eloquent模型和Query构建器，使用原始的Laravel API。<em>该库扩展了原始的Laravel类，因此它使用完全相同的方法。</em></p><h2 id="安装-installation" tabindex="-1"><a class="header-anchor" href="#安装-installation" aria-hidden="true">#</a> 安装（Installation）</h2><p>确保安装了MongoDB PHP驱动程序。您可以在<a href="http://php.net/manual/en/mongodb.installation.php" target="_blank" rel="noopener noreferrer">http://php.net/manual/en/mongodb.installation.php上<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>找到安装说明</p><p><strong>警告</strong>：版本&gt; = 3.0时不再支持旧的mongo PHP驱动程序。</p><p>使用composer安装：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>composer require jenssegers<span class="token operator">/</span>mongodb
</code></pre></div><h3 id="laravel版兼容性" tabindex="-1"><a class="header-anchor" href="#laravel版兼容性" aria-hidden="true">#</a> Laravel版兼容性</h3><table><thead><tr><th style="text-align:left;">Laravel</th><th style="text-align:left;">Package</th></tr></thead><tbody><tr><td style="text-align:left;">4.2.x</td><td style="text-align:left;">2.0.x</td></tr><tr><td style="text-align:left;">5.0.x</td><td style="text-align:left;">2.1.x</td></tr><tr><td style="text-align:left;">5.1.x</td><td style="text-align:left;">2.2.x or 3.0.x</td></tr><tr><td style="text-align:left;">5.2.x</td><td style="text-align:left;">2.3.x or 3.0.x</td></tr><tr><td style="text-align:left;">5.3.x</td><td style="text-align:left;">3.1.x or 3.2.x</td></tr><tr><td style="text-align:left;">5.4.x</td><td style="text-align:left;">3.2.x</td></tr><tr><td style="text-align:left;">5.5.x</td><td style="text-align:left;">3.3.x</td></tr><tr><td style="text-align:left;">5.6.x</td><td style="text-align:left;">3.4.x</td></tr><tr><td style="text-align:left;">5.7.x</td><td style="text-align:left;">3.4.x</td></tr><tr><td style="text-align:left;">5.8.x</td><td style="text-align:left;">3.5.x</td></tr><tr><td style="text-align:left;">6.x</td><td style="text-align:left;">3.6.x</td></tr></tbody></table><p>并在<code>config/app.php</code>添加服务提供商：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">JenssegersMongodbMongodbServiceProvider</span><span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>与<a href="http://lumen.laravel.com/" target="_blank" rel="noopener noreferrer">Lumen一起<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>使用，请在<code>bootstrap/app.php</code>添加服务提供商。在此文件中，您还需要启用Eloquent。不过，你必须确保你调用的<code>$app-&gt;withEloquent();</code>是在您注册MongodbServiceProvider的位置<strong>下面</strong>：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$app<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span>JenssegersMongodbMongodbServiceProvider<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$app<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withEloquent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>服务提供者将使用原始数据库管理器注册mongodb数据库扩展。无需注册其他facades或objects。使用mongodb连接时，Laravel会自动为您提供相应的mongodb对象。</p><p>在Laravel框架外使用，请查看<a href="https://github.com/illuminate/database/blob/master/README.md" target="_blank" rel="noopener noreferrer">Capsule管理器<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>并添加：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$capsule<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getDatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$config</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JenssegersMongodbConnection</span><span class="token punctuation">(</span>$config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="升级-upgrading" tabindex="-1"><a class="header-anchor" href="#升级-upgrading" aria-hidden="true">#</a> 升级（Upgrading）</h2><h4 id="从版本2升级到3" tabindex="-1"><a class="header-anchor" href="#从版本2升级到3" aria-hidden="true">#</a> 从版本2升级到3</h4><p>在支持新MangoDB PHP扩展的新的主要版本中，我们还移动了Model类的位置，并用一个Trait替换了MySQL模型类。</p><p>请在顶级模型文件或注册别名的所有引用<code>JenssegersMongodbModel</code> 改成<code>JenssegersMongodbEloquentModel</code>。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>如果您正在使用混合关系，那么您的MySQL类现在要做的应该是扩展原始的Eloquent模型类<code>IlluminateDatabaseEloquentModel</code>而不是删除<code>JenssegersEloquentModel</code>。可以使用新的<code>JenssegersMongodbEloquentHybridRelations</code> trait来替代。这样使事情更清楚，因为只有一个单一的模型类。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentHybridRelations<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    use HybridRelations<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> $connection <span class="token operator">=</span> <span class="token string">&#39;mysql&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>嵌套关系后，现在返回的是<code>IlluminateDatabaseEloquentCollection</code>而不是自定义Collection类。如果您使用的是一种可用的特殊方法，请将它们转换为Collection操作。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$books <span class="token operator">=</span> $user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="测试-testing" tabindex="-1"><a class="header-anchor" href="#测试-testing" aria-hidden="true">#</a> 测试（Testing）</h2><p>运行此程序包的测试，请运行：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>docker<span class="token operator">-</span>compose up
</code></pre></div><h2 id="配置-configuration" tabindex="-1"><a class="header-anchor" href="#配置-configuration" aria-hidden="true">#</a> 配置（Configuration）</h2><p>在<code>config/database.php</code>更改您的默认数据库连接名称：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;default&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_CONNECTION&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>添加一个新的mongodb连接：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;mongodb&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;driver&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;host&#39;</span>     <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_HOST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;port&#39;</span>     <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_PORT&#39;</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_DATABASE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_USERNAME&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;password&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_PASSWORD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;options&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;admin&#39;</span> <span class="token comment">// sets the authentication database required by mongo 3</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>您可以使用以下配置连接到多个服务器或集群：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;mongodb&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;driver&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;host&#39;</span>     <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;server1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;server2&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#39;port&#39;</span>     <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_PORT&#39;</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_DATABASE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;username&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_USERNAME&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;password&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_PASSWORD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;options&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;replicaSet&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;replicaSetName&#39;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>或者，您可以使用MongoDB连接字符串：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;mongodb&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;driver&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;dsn&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_DSN&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string">&#39;DB_DATABASE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>有关其URI格式，请参阅MongoDB官方文档：<a href="https://docs.mongodb.com/manual/reference/connection-string/" target="_blank" rel="noopener noreferrer">https<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="https://docs.mongodb.com/manual/reference/connection-string/" target="_blank" rel="noopener noreferrer">//docs.mongodb.com/manual/reference/connection-string/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h2 id="eloquent" tabindex="-1"><a class="header-anchor" href="#eloquent" aria-hidden="true">#</a> Eloquent</h2><p>该扩展包包括了一个启用MongoDB的Eloquent类，您可以使用它来定义相应集合的模型。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>请注意，我们没有告诉Eloquent使用哪个集合用于<code>User</code>模型。就像原始的Eloquent一样，除非明确指定其他名称，否则该类的小写复数名称将用作集合名称。您可以通过<code>collection</code>在模型上定义属性来指定自定义集合（表的别名）：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> $collection <span class="token operator">=</span> <span class="token string">&#39;users_collection&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意：</strong> Eloquent还假定每个集合都有一个名为id的主键列。您可以定义一个<code>primaryKey</code>属性来覆盖此约定。同样地，您可以定义一个<code>connection</code>属性来覆盖使用模型时应该使用的数据库连接的名称。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">MyModel</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> $connection <span class="token operator">=</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其他所有（应该）都像原始的Eloquent模型一样工作。在<a href="http://laravel.com/docs/eloquent" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/eloquent<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>上阅读有关Eloquent的更多信息</p><h2 id="可选-别名-optional-alias" tabindex="-1"><a class="header-anchor" href="#可选-别名-optional-alias" aria-hidden="true">#</a> 可选：别名（Optional: Alias）</h2><p>您还可以通过将以下内容添加到<code>config/app.php</code>别名数组中来注册MongoDB模型的别名：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;Moloquent&#39;</span>       <span class="token operator">=&gt;</span> JenssegersMongodbEloquentModel<span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>这将允许您使用注册的别名，如：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyModel</span> <span class="token keyword">extends</span> <span class="token class-name">Moloquent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="查询生成器-query-builder" tabindex="-1"><a class="header-anchor" href="#查询生成器-query-builder" aria-hidden="true">#</a> 查询生成器（Query Builder）</h2><p>数据库驱动程序直接插入原始查询构建器。 使用mongodb连接时，您将能够构建流畅的查询来执行数据库操作。 为方便起见，提供了一个表的集合别名以及一些额外的mongodb特定运算符/操作。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$user <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果您未更改默认数据库连接，则需要在查询时指定它。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在<a href="http://laravel.com/docs/queries" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/queries<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>上阅读有关查询构建器的更多信息</p><h2 id="架构-schema" tabindex="-1"><a class="header-anchor" href="#架构-schema" aria-hidden="true">#</a> 架构（Schema）</h2><p>数据库驱动程序还具有（有限的）schema构建器支持。您可以轻松地操作集合并设置索引：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">Schema</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$collection</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token string">&#39;email&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>支持的操作有：</p><ul><li>create和drop</li><li>collection</li><li>hasCollection</li><li>index和dropIndex (也支持复合索引)</li><li>unique</li><li>background, sparse, expire, geospatial (MongoDB特定)</li></ul><p>所有其他（不支持的）操作都是通过虚拟传递方法实现的，因为MongoDB不使用预定义的模式。在<a href="http://laravel.com/docs/schema" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/schema<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>上阅读有关架构构建器的更多信息</p><h3 id="地理空间索引-geospatial" tabindex="-1"><a class="header-anchor" href="#地理空间索引-geospatial" aria-hidden="true">#</a> 地理空间索引（geospatial ）</h3><p>地理空间索引可用于查询基于位置的文档。它们有两种形式：<code>2d</code>和<code>2dsphere</code>。使用schema构建器将这些添加到集合中。</p><p>添加<code>2d</code>索引：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">Schema</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$collection</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>添加<code>2dsphere</code>索引：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">Schema</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$collection</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2dsphere&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="扩展-extensions" tabindex="-1"><a class="header-anchor" href="#扩展-extensions" aria-hidden="true">#</a> 扩展（Extensions）</h2><h3 id="验证" tabindex="-1"><a class="header-anchor" href="#验证" aria-hidden="true">#</a> 验证</h3><p>如果您想使用Laravel的自带的Auth功能，请注册此包含的服务提供商：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;JenssegersMongodbAuthPasswordResetServiceProvider&#39;</span><span class="token punctuation">,</span>
</code></pre></div><p>此服务提供程序将稍微修改内部DatabaseReminderRepository以添加对基于MongoDB的密码提醒的支持。如果您不使用密码提醒，则无需注册此服务提供商，其他一切都应该正常工作。</p><h3 id="队列" tabindex="-1"><a class="header-anchor" href="#队列" aria-hidden="true">#</a> 队列</h3><p>如果要将MongoDB用作数据库后端，请在<code>config/queue.php</code>更改以下驱动程序：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;connections&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;driver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;table&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string">&#39;jobs&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;queue&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;expire&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>如果要使用MongoDB处理失败的作业，请在<code>config/queue.php</code>以下位置更改数据库：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token string">&#39;failed&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;database&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;table&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string">&#39;failed_jobs&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>并在<code>config/app.php</code>添加服务提供商：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">JenssegersMongodbMongodbQueueServiceProvider</span><span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="sentry" tabindex="-1"><a class="header-anchor" href="#sentry" aria-hidden="true">#</a> Sentry</h3><p>如果您想将此库与<a href="https://cartalyst.com/manual/sentry" target="_blank" rel="noopener noreferrer">Sentry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>一起使用，请查看<a href="https://github.com/jenssegers/Laravel-MongoDB-Sentry" target="_blank" rel="noopener noreferrer">https://github.com/jenssegers/Laravel-MongoDB-Sentry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="sessions" tabindex="-1"><a class="header-anchor" href="#sessions" aria-hidden="true">#</a> Sessions</h3><p>MongoDB会话驱动程序在单独的包中提供，请查看<a href="https://github.com/jenssegers/Laravel-MongoDB-Session" target="_blank" rel="noopener noreferrer">https://github.com/jenssegers/Laravel-MongoDB-Session<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h2 id="例子-examples" tabindex="-1"><a class="header-anchor" href="#例子-examples" aria-hidden="true">#</a> 例子（Examples）</h2><h3 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法" aria-hidden="true">#</a> 基本用法</h3><p><strong>检索所有模型</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>通过主键_id检索记录</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;517c43667db388101e00000f&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Wheres</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;votes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Or</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;votes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>And</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;votes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;=&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>WhereIn</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用<code>whereNotIn</code>时，如果字段不存在，将返回使用对象。可以结合<code>whereNotNull(&#39;age&#39;)</code>来过滤这些文件。</p><p><strong>Between</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token string">&#39;votes&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Null</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">whereNull</span><span class="token punctuation">(</span><span class="token string">&#39;updated_at&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Order By</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;desc&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Offset &amp; Limit</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Distinct</strong></p><p>Distinct需要一个字段，返回不重复的值。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以与<strong>where</strong>结合使用：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;active&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>复杂的Wheres</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;=&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        $query<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;votes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
              <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Admin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Group By</strong></p><p>未分组的选定列将与$last函数聚合在一起。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> Users<span class="token operator">:</span><span class="token operator">:</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>聚合(Aggregation)</strong></p><p><em>聚合仅适用于大于2.2的MongoDB版本。</em></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$total <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$price <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$price <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$price <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$total <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>聚合可以结合<strong>where</strong>：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$sold <span class="token operator">=</span> Orders<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;sold&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>聚合也可以用于子文档：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$total <span class="token operator">=</span> Order<span class="token operator">:</span><span class="token operator">:</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">&#39;suborder.price&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre></div><p><strong>注意</strong>：此aggreagtion仅适用于单个子文档（如embedsOne）而非子文档数组（如embedsMany）</p><p><strong>Like</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> Comment<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;like&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;%spam%&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>递增或递减</strong></p><p>对指定的属性执行增量或减量（默认值1）：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Jaques&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">&#39;weight&#39;</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>返回更新的对象数：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$count <span class="token operator">=</span> User<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您还可以指定要更新的其他列：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;29&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;group&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;thirty something&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;bmi&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">&#39;bmi&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;category&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;overweight&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>软删除</strong></p><p>软删除模型时，实际上并未从数据库中删除它。而是在记录上设置deleted_at时间戳。要为模型启用软删除，请将SoftDeletingTrait应用于模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentSoftDeletes<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    use SoftDeletes<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> $dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;deleted_at&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有关更多信息，请访问<a href="http://laravel.com/docs/eloquent#soft-deleting" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/eloquent#soft-deleting<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="mongodb特定的操作" tabindex="-1"><a class="header-anchor" href="#mongodb特定的操作" aria-hidden="true">#</a> MongoDB特定的操作</h3><p><strong>Exists</strong></p><p>匹配具有指定字段的文档。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;exists&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>All</strong></p><p>匹配包含查询中指定的所有元素的数组。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;roles&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;moderator&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;author&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Size</strong></p><p>如果数组字段是指定大小，则选择文档。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;tags&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;size&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>正则表达式</strong></p><p>选择值与指定正则表达式匹配的文档。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;regex&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MongoDBBSONRegex</span><span class="token punctuation">(</span><span class="token string">&quot;/.*doe/i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>**注意：**您还可以使用Laravel regexp操作。这些更灵活，会自动将正则表达式字符串转换为 MongoDBBSONRegex 对象。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;regexp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/.*doe/i&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>反之：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;not regexp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/.*doe/i&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Type</strong></p><p>如果字段是指定类型，则选择文档。有关更多信息，请访问：<a href="http://docs.mongodb.org/manual/reference/operator/query/type/#op._S_type" target="_blank" rel="noopener noreferrer">http<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="http://docs.mongodb.org/manual/reference/operator/query/type/#op._S_type" target="_blank" rel="noopener noreferrer">//docs.mongodb.org/manual/reference/operator/query/type/#op._S_type<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;type&#39;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Mod</strong></p><p>对字段的值执行模运算，并选择具有指定结果的文档。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mod&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Near</strong></p><p>**注意：**按此顺序指定坐标：<code>longitude, latitude</code>。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;location&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;near&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;$geometry&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Point&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;coordinates&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span>
            <span class="token number">51.5100913</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&#39;$maxDistance&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoWithin</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;location&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;geoWithin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;$geometry&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Polygon&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;coordinates&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span>
                <span class="token number">51.5069158</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span>
                <span class="token number">51.5100913</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.1270247</span><span class="token punctuation">,</span>
                <span class="token number">51.5013233</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span>
                <span class="token number">51.5069158</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoIntersects</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$locations <span class="token operator">=</span> Location<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;location&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;geoIntersects&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;$geometry&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;LineString&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;coordinates&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.144044</span><span class="token punctuation">,</span>
                <span class="token number">51.515215</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                <span class="token operator">-</span><span class="token number">0.129545</span><span class="token punctuation">,</span>
                <span class="token number">51.507864</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Where</strong></p><p>匹配满足JavaScript表达式的文档。有关更多信息，请访问<a href="http://docs.mongodb.org/manual/reference/operator/query/where/#op._S_where" target="_blank" rel="noopener noreferrer">http://docs.mongodb.org/manual/reference/operator/query/where/#op._S_where<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="inserts-updates-and-deletes" tabindex="-1"><a class="header-anchor" href="#inserts-updates-and-deletes" aria-hidden="true">#</a> Inserts, updates and deletes</h3><p>插入，更新和删除记录就像原始的Eloquent一样。</p><p><strong>保存新模型</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span>name <span class="token operator">=</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您还可以使用简单一行create方法将新模型保存：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>更新模型</strong></p><p>要更新模型，您可以检索它，更改属性并使用save方法。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span>email <span class="token operator">=</span> <span class="token string">&#39;john@foo.com&#39;</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>还有对upsert操作的支持，请查看<a href="https://github.com/jenssegers/laravel-mongodb#mongodb-specific-operations" target="_blank" rel="noopener noreferrer">https://github.com/jenssegers/laravel-mongodb#mongodb-specific-operations<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></em></p><p><strong>删除模型</strong></p><p>要删除模型，只需在实例上调用delete方法：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者通过_id值删除模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token string">&#39;517c43667db388101e00000f&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>有关模型操作的更多信息，请查看<a href="http://laravel.com/docs/eloquent#insert-update-delete" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/eloquent#insert-update-delete<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="日期" tabindex="-1"><a class="header-anchor" href="#日期" aria-hidden="true">#</a> 日期</h3><p>Eloquent允许您使用Carbon/DateTime对象而不是MongoDate对象。在内部，这些日期在保存到数据库时将转换为MongoDate对象。如果您希望在非默认日期字段上使用此功能，则需要按照此处所述手动指定它们：<a href="http://laravel.com/docs/eloquent#date-mutators" target="_blank" rel="noopener noreferrer">http<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="http://laravel.com/docs/eloquent#date-mutators" target="_blank" rel="noopener noreferrer">//laravel.com/docs/eloquent#date-mutators<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><p>例：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> $dates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;birthday&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这允许您执行以下查询：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;birthday&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&gt;&#39;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token string">&#39;-18 years&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="关系" tabindex="-1"><a class="header-anchor" href="#关系" aria-hidden="true">#</a> 关系</h3><p>支持的关系有：</p><ul><li>hasOne</li><li>hasMany</li><li>belongsTo</li><li>belongsToMany</li><li>embedsOne</li><li>embedsMany</li></ul><p>例：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&#39;Item&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>和反比关系：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>belongsToMany关系不会使用中间关系“table”（表），而是将id推送到related_ids属性。这使belongsToMany方法的第二个参数无用。如果要为关系定义自定义键，请将其设置为<code>null</code>：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span><span class="token string">&#39;Group&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;user_ids&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;group_ids&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其他关系尚未得到支持，但可能会在未来添加。有关这些关系的更多信息，请访问<a href="http://laravel.com/docs/eloquent#relationships" target="_blank" rel="noopener noreferrer">http://laravel.com/docs/eloquent#relationships<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="embedsmany-relations" tabindex="-1"><a class="header-anchor" href="#embedsmany-relations" aria-hidden="true">#</a> EmbedsMany Relations</h3><p>如果要嵌入模型而不是引用模型，可以使用<code>embedsMany</code>关系。此关系类似于<code>hasMany</code>关系，但将模型嵌入父对象中。</p><p><strong>记住</strong>：这些关系返回El​​oquent集合，它们不返回查询构建器对象！</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span><span class="token string">&#39;Book&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您可以通过动态属性访问嵌入式模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$books <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>books<span class="token punctuation">;</span>
</code></pre></div><p>反向关系是自动_神奇_可用的，您不需要定义此反向关系。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> $book<span class="token operator">-</span><span class="token operator">&gt;</span>user<span class="token punctuation">;</span>
</code></pre></div><p>插入和更新嵌入式模型的工作方式类似于以下<code>hasMany</code>关系：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;A Game of Thrones&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$user <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$book <span class="token operator">=</span> $user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>$book<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
$book <span class="token operator">=</span> $user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;A Game of Thrones&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>您可以使用他们的<code>save</code>方法更新嵌入式模型（从2.0.0版开始提供）：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$book <span class="token operator">=</span> $user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$book<span class="token operator">-</span><span class="token operator">&gt;</span>title <span class="token operator">=</span> <span class="token string">&#39;A Game of Thrones&#39;</span><span class="token punctuation">;</span>
$book<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您可以使用<code>destroy</code>关系上的<code>delete</code>方法或模型上的方法（从2.0.0版开始提供）来删除嵌入式模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$book <span class="token operator">=</span> $user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$book<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroy</span><span class="token punctuation">(</span>$book<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果要在不触及数据库的情况下添加或删除嵌入式模型，可以使用<code>associate</code>和<code>dissociate</code>方法。要最终将更改写入数据库，请保存父对象：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">associate</span><span class="token punctuation">(</span>$book<span class="token punctuation">)</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>与其他关系一样，embedsMany根据模型名称假定关系的本地键。您可以通过将第二个参数传递给embedsMany方法来覆盖默认本地键：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span><span class="token string">&#39;Book&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;local_key&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>嵌入式关系将返回嵌入项的集合，而不是查询构建器。查看可用的操作：<a href="https://laravel.com/docs/master/collections" target="_blank" rel="noopener noreferrer">https<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="https://laravel.com/docs/master/collections" target="_blank" rel="noopener noreferrer">//laravel.com/docs/master/collections<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="embedsone-relations" tabindex="-1"><a class="header-anchor" href="#embedsone-relations" aria-hidden="true">#</a> EmbedsOne Relations</h3><p>embedsOne关系类似于EmbedsMany关系，但只嵌入单个模型。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsOne</span><span class="token punctuation">(</span><span class="token string">&#39;Author&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您可以通过动态属性访问嵌入式模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$author <span class="token operator">=</span> Book<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>author<span class="token punctuation">;</span>
</code></pre></div><p>插入和更新嵌入式模型的工作方式类似于以下<code>hasOne</code>关系：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$author <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$book <span class="token operator">=</span> Books<span class="token operator">:</span><span class="token operator">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$author <span class="token operator">=</span> $book<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>$author<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or</span>
$author <span class="token operator">=</span> $book<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您可以使用该<code>save</code>方法更新嵌入式模型（从2.0.0版开始提供）：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$author <span class="token operator">=</span> $book<span class="token operator">-</span><span class="token operator">&gt;</span>author<span class="token punctuation">;</span>
$author<span class="token operator">-</span><span class="token operator">&gt;</span>name <span class="token operator">=</span> <span class="token string">&#39;Jane Doe&#39;</span><span class="token punctuation">;</span>
$author<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您可以使用以下新模型替换嵌入式模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$newAuthor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Jane Doe&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$book<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>$newAuthor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mysql关系" tabindex="-1"><a class="header-anchor" href="#mysql关系" aria-hidden="true">#</a> MySQL关系</h3><p>如果你正在使用混合的MongoDB和SQL设置，那么你很幸运！模型将根据相关模型的类型自动返回MongoDB或SQL关系。当然，如果您希望此功能同时工作，那么您的SQL模型将需要使用该<code>JenssegersMongodbEloquentHybridRelations</code>特征。请注意，此功能仅适用于hasOne，hasMany和belongsTo关系。</p><p>示例基于SQL的用户模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentHybridRelations<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    use HybridRelations<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> $connection <span class="token operator">=</span> <span class="token string">&#39;mysql&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">messages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span><span class="token string">&#39;Message&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而基于Mongodb的Message模型：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>use JenssegersMongodbEloquentModel <span class="token keyword">as</span> Eloquent<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token keyword">extends</span> <span class="token class-name">Eloquent</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> $connection <span class="token operator">=</span> <span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="原始表达" tabindex="-1"><a class="header-anchor" href="#原始表达" aria-hidden="true">#</a> 原始表达</h3><p>这些表达式将直接注入查询中。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token literal-property property">User</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token string">&#39;$gt&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&#39;$lt&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您还可以在内部MongoCollection对象上执行原始表达式。如果在模型类上执行此操作，它将返回一组模型。如果在查询构建器上执行此操作，它将返回原始响应。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// Returns a collection of User models.</span>
$models <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$collection</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Returns the original MongoCursor.</span>
$cursor <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$collection</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> $collection<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可选：如果未将闭包传递给raw方法，则可以访问内部MongoCollection对象：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$model <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token string">&#39;$lt&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以像这样访问内部MongoClient和MongoDB对象：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$client <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">getMongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$db <span class="token operator">=</span> <span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">getMongoDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mongodb的具体操作" tabindex="-1"><a class="header-anchor" href="#mongodb的具体操作" aria-hidden="true">#</a> MongoDB的具体操作</h3><p><strong>光标超时（Cursor timeout）</strong></p><p>要防止MongoCursorTimeout异常，您可以手动设置将应用于游标的超时值：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Upsert</strong></p><p>更新或插入文档。update方法的其他选项将直接传递给本机更新方法。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span>
                       <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>$data<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;upsert&#39;</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Projections</strong></p><p>您可以使用该<code>project</code>方法将投影应用于查询。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;tags&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;$slice&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;tags&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;$slice&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>分页（Pagination）</strong></p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$limit <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
$projections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span>$limit<span class="token punctuation">,</span> $projections<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Push</strong></p><p>将项添加到数组。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;boots&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;messages&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;from&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Jane Doe&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;message&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Hi John&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果您不想要重复项，请将第三个参数设置为<code>true</code>：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;boots&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Pull</strong></p><p>从数组中删除项目。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string">&#39;items&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;boots&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string">&#39;messages&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;from&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Jane Doe&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;message&#39;</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;Hi John&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Unset</strong></p><p>从文档中删除一个或多个字段。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unset</span><span class="token punctuation">(</span><span class="token string">&#39;note&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您还可以在模型上执行删除。</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$user <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;John&#39;</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$user<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unset</span><span class="token punctuation">(</span><span class="token string">&#39;note&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="查询缓存-query-caching" tabindex="-1"><a class="header-anchor" href="#查询缓存-query-caching" aria-hidden="true">#</a> 查询缓存(Query Caching)</h3><p>您可以使用remember方法轻松缓存查询结果：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>$users <span class="token operator">=</span> User<span class="token operator">:</span><span class="token operator">:</span><span class="token function">remember</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>来自：<a href="http://laravel.com/docs/queries#caching-queries" target="_blank" rel="noopener noreferrer">http<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="http://laravel.com/docs/queries#caching-queries" target="_blank" rel="noopener noreferrer">//laravel.com/docs/queries#caching-queries<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></em></p><h3 id="查询记录-query-logging" tabindex="-1"><a class="header-anchor" href="#查询记录-query-logging" aria-hidden="true">#</a> 查询记录(Query Logging)</h3><p>默认情况下，Laravel会记录已为当前请求运行的所有查询的内存。但是，在某些情况下，例如插入大量行时，这可能会导致应用程序使用过多的内存。要禁用日志，您可以使用以下<code>disableQueryLog</code>方法：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token constant">DB</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disableQueryLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>来自：<a href="http://laravel.com/docs/database#query-logging" target="_blank" rel="noopener noreferrer">http<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>：<a href="http://laravel.com/docs/database#query-logging" target="_blank" rel="noopener noreferrer">//laravel.com/docs/database#query-logging<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></em></p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/lzwdot/blog/edit/main/docs/server/laravel/22778.md" rel="noopener noreferrer" target="_blank" aria-label="编辑页面"><!--[--><!--]--> 编辑页面 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/blog/server/laravel/22773.html" class="" aria-label="Laravel Entrust中文说明"><!--[--><!--]--> Laravel Entrust中文说明 <!--[--><!--]--></a></span><span class="next"><a href="/blog/server/laravel/22793.html" class="" aria-label="Laravel5.5 Blade模板-@yield @section @show @stop @append @overwrite标签区别"><!--[--><!--]--> Laravel5.5 Blade模板-@yield @section @show @stop @append @overwrite标签区别 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.4ca8afde.js" defer></script>
  </body>
</html>
